import { IconUserCircle, IconKey } from "@douyinfe/semi-icons";
import { Button, Form, Table } from "@douyinfe/semi-ui";
import React, { Component, useEffect } from "react";
import { Link } from "react-router-dom";
import { IconDelete } from "@douyinfe/semi-icons";
import { useState } from "react";
import "./index.scss";
import { raw } from "./constants";
import axios from "axios";

const Manage = () => {
  const [dataSource, setData] = useState(raw);
  const [deleteData, setDeleteData] = useState<number>(0);

  const removeRecord = (key: React.SetStateAction<number>) => {
    let newDataSource = [...dataSource];
    setDeleteData(key);
    if (key != null) {
      let idx = newDataSource.findIndex((data) => data.userId === key);
      if (idx > -1) {
        newDataSource.splice(idx, 1);
        deleteManager();
        setData(newDataSource);
      }
    }
  };
  const deleteManager = async () => {
    try {
      const token = window.localStorage.getItem("token");
      await axios.post(
        "https://3j783p6226.zicp.fun/shisifan/user/delete",
        {
          userId: deleteData,
        },
        {
          headers: {
            token: token,
          },
        }
      );
    } catch (err) {
      console.log(err);
    }
  };
  const getListData = async () => {
    try {
      const token = window.localStorage.getItem("token");
      const res = await axios.get(
        "https://3j783p6226.zicp.fun/shisifan/user/list" +
          "?page=1&pageLimit=10",
        {
          headers: {
            token: token,
          },
        }
      );
      setData(res?.data?.data?.users);
    } catch (err) {
      console.log(err);
    }
  };
  useEffect(() => {
    getListData();
  }, []);
  const columns = [
    {
      title: "用户名",
      dataIndex: "username",
    },
    {
      title: "用户id",
      dataIndex: "userId",
    },
    {
      title: "邮箱",
      dataIndex: "email",
      width: 200,
    },
    {
      title: "密码",
      dataIndex: "password",
      width: 200,
    },
    {
      title: "",
      dataIndex: "operate",
      render: (text, record) => (
        <Button
          icon={<IconDelete />}
          theme="borderless"
          onClick={() => removeRecord(record.userId)}
        />
      ),
    },
  ];
  return (
    <div className="manage-content">
      <div className="left">
        <div className="person-message">
          <div className="person-message-title">个人信息</div>
          <div className="person-message-avator">
            <div className="avator">
              <div className="svg">
                <svg
                  t="1682407928372"
                  class="icon"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="1627"
                  width="100"
                  height="100"
                >
                  <path
                    d="M309.52 494.12c-1.94 0-3.47 0.28-4.67 0.76 1.63-0.49 3.37-0.76 5.16-0.76L309.52 494.12zM845.13 707.52c0.05-0.99 0.18-1.96 0.39-2.9C845.29 705.05 845.17 705.97 845.13 707.52zM880.86 313.29c0.01-0.04 0.01-0.09 0.01-0.13l0-0.46C880.87 312.9 880.87 313.1 880.86 313.29zM845.11 313.23c0 0.04 0 0.08 0.01 0.12-0.01-0.21-0.01-0.43-0.01-0.65L845.11 313.23zM866.673 849.43c-5.03-37.45-16.03-73.61-32.69-107.48-3.26-6.62-6.71-13.13-10.37-19.51-0.01-0.02-0.02-0.04-0.04-0.06-15.86-26.86-35.32-51.8-58-74.06l-0.01-0.01c-4.93-4.84-10.01-9.56-15.24-14.14-37.29-32.68-80.34-56.91-126.25-71.65 8.31-4.6 16.35-9.76 24.07-15.47 8.79-6.48 17.16-13.68 25.03-21.55 41.39-41.39 64.19-96.43 64.19-154.97 0-58.54-22.8-113.58-64.19-154.97-40.64-40.64-94.44-63.35-151.78-64.17-0.91-0.01-1.82-0.02-2.73-0.02-0.91 0-1.82 0.01-2.73 0.02-57.34 0.82-111.14 23.53-151.78 64.17-41.39 41.39-64.19 96.43-64.19 154.97 0 58.54 22.8 113.58 64.19 154.97 7.87 7.87 16.24 15.07 25.03 21.55 7.72 5.71 15.76 10.87 24.07 15.47-45.91 14.74-88.96 38.97-126.25 71.65-5.23 4.58-10.31 9.3-15.24 14.14-22.7 22.28-42.18 47.24-58.05 74.13-3.66 6.38-7.11 12.89-10.37 19.51-16.66 33.87-27.66 70.03-32.69 107.48-1.61 12 6.81 23.03 18.8 24.64 0.99 0.13 1.98 0.2 2.95 0.2 0.89 0 1.76-0.05 2.63-0.16 8.67-1.89 15.67-8.96 17.03-18.25 10.1-69.32 43.14-132.31 90.63-180.28 56.36-56.95 133.07-92.74 215.97-92.88l0.47 0c82.72 0.28 159.25 36.04 215.5 92.88 47.49 47.97 80.53 110.96 90.63 180.28 1.36 9.27 8.33 16.33 16.98 18.24 0.02 0 0.03 0.01 0.05 0.01 0.87 0.11 1.74 0.16 2.63 0.16 0.97 0 1.96-0.07 2.95-0.2C859.863 872.46 868.283 861.43 866.673 849.43zM518.193 545.86c-0.44 0-0.88 0-1.32-0.01-81.8-0.6-154.73-57.43-174.66-133.66-0.22-0.83-0.44-1.67-0.64-2.51-3.12-12.6-4.78-25.7-4.78-39.15 0-13.45 1.66-26.7 4.78-39.52 0.2-0.86 0.42-1.71 0.64-2.56 20.04-78.14 93.65-140.25 175.98-140.25l0.94 0c82.33 0 155.94 62.11 175.98 140.25 0.22 0.85 0.44 1.7 0.64 2.56 3.12 12.82 4.78 26.07 4.78 39.52 0 13.45-1.66 26.55-4.78 39.15-0.2 0.84-0.42 1.68-0.64 2.51-19.93 76.23-92.86 133.06-174.66 133.66C519.703 545.86 518.953 545.86 518.193 545.86z"
                    fill="#ffffff"
                    p-id="1628"
                  ></path>
                </svg>
              </div>
              <div className="name">石思凡</div>
            </div>
            <div className="message">
              <div className="tabphone">
                <svg
                  t="1682408786357"
                  class="icon"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="2813"
                  width="30"
                  height="30"
                >
                  <path
                    d="M736.653061 929.959184H287.346939c-45.97551 0-83.591837-37.616327-83.591837-83.591837V177.632653c0-45.97551 37.616327-83.591837 83.591837-83.591837h449.306122c45.97551 0 83.591837 37.616327 83.591837 83.591837v668.734694c0 45.97551-37.616327 83.591837-83.591837 83.591837zM287.346939 135.836735c-22.987755 0-41.795918 18.808163-41.795919 41.795918v668.734694c0 22.987755 18.808163 41.795918 41.795919 41.795918h449.306122c22.987755 0 41.795918-18.808163 41.795919-41.795918V177.632653c0-22.987755-18.808163-41.795918-41.795919-41.795918H287.346939z"
                    fill="#bfbfbf"
                    p-id="2814"
                  ></path>
                  <path
                    d="M616.489796 815.020408H407.510204c-11.493878 0-20.897959-9.404082-20.897959-20.897959s9.404082-20.897959 20.897959-20.897959h208.979592c11.493878 0 20.897959 9.404082 20.897959 20.897959s-9.404082 20.897959-20.897959 20.897959z"
                    fill="#bfbfbf"
                    p-id="2815"
                  ></path>
                </svg>
                <div className="title">手机</div>
                <div className="number">15102946659</div>
              </div>
              <div className="approve">
                <svg
                  t="1682409353447"
                  class="icon"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="4872"
                  width="30"
                  height="30"
                >
                  <path
                    d="M501.771543 747.094366l-21.295002-1.199315-97.619318-331.916529-91.555206 0c-6.252401 0-11.320836-5.068436-11.320836-11.320836 0-6.252401 5.068436-11.320836 11.320836-11.320836l100.026134 0 10.861372 8.126075 91.045599 309.561381 147.68969-350.765829 10.43363-6.927783 65.522296 0c6.251378 0 11.320836 5.068436 11.320836 11.320836 0 6.252401-5.068436 11.320836-11.320836 11.320836l-58.006112 0L501.771543 747.094366z"
                    fill="#bfbfbf"
                    p-id="4873"
                  ></path>
                  <path
                    d="M511.349689 893.257284c-102.394065 0-198.657502-39.874149-271.061532-112.279203-72.403007-72.403007-112.278179-168.668491-112.278179-271.062556s39.874149-198.658526 112.278179-271.062556c72.403007-72.403007 168.667467-112.277156 271.061532-112.277156 102.395088 0 198.660572 39.874149 271.064602 112.277156 72.40403 72.403007 112.278179 168.668491 112.278179 271.062556 0 102.394065-39.874149 198.659549-112.278179 271.062556C710.010261 853.384158 613.744777 893.257284 511.349689 893.257284zM511.349689 149.21851c-198.888769 0-360.697015 161.809269-360.697015 360.698039 0 198.889793 161.808246 360.699062 360.697015 360.699062 198.889793 0 360.700085-161.809269 360.700085-360.699062C872.049774 311.027779 710.239482 149.21851 511.349689 149.21851z"
                    fill="#bfbfbf"
                    p-id="4874"
                  ></path>
                </svg>
                <div className="title">企业认证</div>
                <div className="already">已认证</div>
              </div>
              <div className="mail">
                <svg
                  t="1682410331989"
                  class="icon"
                  viewBox="0 0 1024 1024"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  p-id="6220"
                  width="30"
                  height="30"
                >
                  <path
                    d="M874.666667 181.333333H149.333333c-40.533333 0-74.666667 34.133333-74.666666 74.666667v512c0 40.533333 34.133333 74.666667 74.666666 74.666667h725.333334c40.533333 0 74.666667-34.133333 74.666666-74.666667V256c0-40.533333-34.133333-74.666667-74.666666-74.666667z m-725.333334 64h725.333334c6.4 0 10.666667 4.266667 10.666666 10.666667v25.6L512 516.266667l-373.333333-234.666667V256c0-6.4 4.266667-10.666667 10.666666-10.666667z m725.333334 533.333334H149.333333c-6.4 0-10.666667-4.266667-10.666666-10.666667V356.266667l356.266666 224c4.266667 4.266667 10.666667 4.266667 17.066667 4.266666s12.8-2.133333 17.066667-4.266666l356.266666-224V768c0 6.4-4.266667 10.666667-10.666666 10.666667z"
                    fill="#bfbfbf"
                    p-id="6221"
                  ></path>
                </svg>
                <div className="title">邮箱</div>
                <div className="email-number">1449348331@qq.com</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div className="right">
        <div className="manager-title">管理员列表</div>
        <div className="manager-list">
          <Table
            style={{ minHeight: 350 }}
            columns={columns}
            dataSource={dataSource}
            pagination={true}
            scroll={{ y: 350 }}
          />
        </div>
      </div>
    </div>
  );
};
export default Manage;
